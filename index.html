<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enhanced School Countdown with Lessons</title>

<!-- Favicon -->
<link rel="icon" type="image/png" href="images/logo.png">
<link rel="apple-touch-icon" href="images/logo.png">

<style>
html, body {
    margin: 0; padding: 0; height: 100%; width: 100%; overflow: hidden;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    position: relative;
}
body::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: var(--bg-image) no-repeat center center fixed;
    background-size: cover;
    opacity: 1;
    z-index: 0;
    transition: background 1s ease-in-out, opacity 1s ease-in-out;
}
.card {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0,0,0,0.5);
    padding: 30px 40px;
    border-radius: 20px;
    text-align: center;
    border: 2px solid orange;
    color: orange;
    z-index: 2;
    width: 90%; max-width: 500px;
}
h1 {
    font-size: 3rem;
    margin-bottom: 15px;
    text-shadow: 0 0 5px #ff8c00, 0 0 10px #ff8c00;
}
#countdown {
    font-size: 2rem;
    margin: 15px 0;
    padding: 15px;
    border-radius: 15px;
    border: 2px solid orange;
    background: rgba(0,0,0,0.3);
    color: orange;
    text-shadow: 0 0 5px #ff8c00, 0 0 10px #ff8c00;
    white-space: pre-line;
}
#lessonInfo {
    font-size: 1.2rem;
    margin-top: 10px;
    white-space: pre-line;
}
#progressBar {
    width: 100%;
    background: rgba(255,255,255,0.2);
    border-radius: 15px;
    overflow: hidden;
    margin-top: 10px;
}
#progress {
    width: 0%;
    height: 15px;
    background: orange;
    border-radius: 15px;
    transition: width 0.5s;
}
#moodImage {
    margin-top: 15px;
    width: 200px;
    border-radius: 15px;
    border: 2px solid orange;
    opacity: 1;
    transition: opacity 1s;
}
.star {
    position: absolute;
    border-radius: 50%;
    background: white;
    opacity: 0.8;
    z-index: 1;
}
</style>
</head>
<body>
<div class="card">
    <h1>School Countdown</h1>
    <div id="countdown">Loading...</div>
    <div id="lessonInfo"></div>
    <div id="progressBar">
        <div id="progress"></div>
    </div>
    <img id="moodImage" src="images/Sad.png" alt="Mood Image">
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
// ==== Starry Sky ====
const numStars = 150;
const stars = [];
for (let i = 0; i < numStars; i++) {
    const star = document.createElement('div');
    star.classList.add('star');
    star.style.top = Math.random() * window.innerHeight + 'px';
    star.style.left = Math.random() * window.innerWidth + 'px';
    const size = Math.random() * 2 + 1;
    star.style.width = size + 'px';
    star.style.height = size + 'px';
    star.dataset.speed = Math.random() * 0.2 + 0.05;
    star.dataset.opacity = Math.random() * 0.5 + 0.5;
    document.body.appendChild(star);
    stars.push(star);
}
function animateStars() {
    stars.forEach(star => {
        const twinkle = Math.sin(Date.now() * 0.002 + Math.random() * 100) * 0.5 + 0.5;
        star.style.opacity = star.dataset.opacity * twinkle;
        let left = parseFloat(star.style.left);
        left += parseFloat(star.dataset.speed);
        if (left > window.innerWidth) left = 0;
        star.style.left = left + 'px';
    });
    requestAnimationFrame(animateStars);
}
animateStars();

// ==== Timetable ====
const timetable = {
    1: [ // Monday
        { start: "08:10", end: "09:50", name: "BL / CaMa Bild" },
        { start: "10:00", end: "11:05", name: "SV / LiWi" },
        { start: "11:15", end: "12:20", name: "M2SPA / PeFe" },
        { start: "13:00", end: "13:55", name: "AnFe / MaKa" },
        { start: "14:05", end: "14:35", name: "TK / MaKa / Fy-sal" }
    ],
    2: [ // Tuesday
        { start: "08:20", end: "09:30", name: "EN / MiJo" },
        { start: "09:40", end: "10:15", name: "MA / MaKa" },
        { start: "10:30", end: "11:55", name: "SL / MAS / SlTx" },
        { start: "12:55", end: "13:35", name: "SO / AnFe" },
        { start: "14:15", end: "14:35", name: "FY / AnnMå" }
    ],
    3: [ // Wednesday
        { start: "08:00", end: "08:50", name: "RoAn / MaKa" },
        { start: "09:00", end: "09:50", name: "SO / AnFe" },
        { start: "10:00", end: "10:45", name: "M2SPA / PeFe" },
        { start: "11:05", end: "12:00", name: "SV / LiWi" },
        { start: "12:20", end: "13:05", name: "KE / AnnMå" },
        { start: "13:05", end: "13:25", name: "EN / MiJo" },
        { start: "14:40", end: "15:20", name: "Ment / LiWi" }
    ],
    4: [ // Thursday
        { start: "09:00", end: "09:50", name: "M2SPA / PeFe" },
        { start: "10:00", end: "10:45", name: "SV / LiWi" },
        { start: "11:05", end: "12:00", name: "BI / AnnMå" },
        { start: "13:05", end: "13:35", name: "EN / MiJo" },
        { start: "14:05", end: "15:20", name: "IDH / SuBe" }
    ],
    5: [ // Friday
        { start: "08:10", end: "09:10", name: "MA / MaKa" },
        { start: "09:30", end: "10:35", name: "SO / AnFe" },
        { start: "10:55", end: "12:15", name: "IDH / SuBe" },
        { start: "12:55", end: "13:55", name: "SO / AnFe" },
        { start: "14:10", end: "14:55", name: "MU / ArBo" }
    ]
};

// ==== School Countdown Data ====
const startDateTime = new Date(2025, 7, 19, 8, 30);
const endDate = new Date(2026, 5, 12, 0, 0);
const breaks = [
    { from: new Date(2025, 9, 27), to: new Date(2025, 9, 31) },
    { from: new Date(2026, 1, 16), to: new Date(2026, 1, 20) },
    { from: new Date(2026, 2, 30), to: new Date(2026, 3, 2) },
    { from: new Date(2026, 4, 15), to: new Date(2026, 4, 15) },
    { from: new Date(2025, 10, 17), to: new Date(2025, 10, 17) },
    { from: new Date(2026, 0, 7), to: new Date(2026, 0, 7) },
    { from: new Date(2026, 2, 3), to: new Date(2026, 2, 3) },
    { from: new Date(2025, 11, 3), to: new Date(2025, 11, 3) },
    { from: new Date(2026, 4, 25), to: new Date(2026, 4, 25) }
];

function isWeekend(date) {
    const day = date.getDay();
    return day === 0 || day === 6;
}
function currentBreak(date) {
    return breaks.find(b => date >= b.from && date <= b.to);
}
function formatDHMS(ms) {
    const totalSeconds = Math.floor(ms / 1000);
    const days = Math.floor(totalSeconds / (3600 * 24));
    const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    return `${days}d ${hours}h ${minutes}m ${seconds}s`;
}
function countSchoolDays(fromDate, toDate) {
    let count = 0;
    let current = new Date(fromDate);
    while (current <= toDate) {
        if (!isWeekend(current) && !currentBreak(current)) count++;
        current.setDate(current.getDate() + 1);
    }
    return count;
}
function triggerConfetti() {
    confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
}
function getLessonInfo(now) {
    const weekday = now.getDay();
    const todayLessons = timetable[weekday] || [];
    const currentTime = now.toTimeString().slice(0,5);
    let currentLesson = null, nextLesson = null;

    for (let i = 0; i < todayLessons.length; i++) {
        if (currentTime >= todayLessons[i].start && currentTime <= todayLessons[i].end) {
            currentLesson = todayLessons[i].name;
            nextLesson = todayLessons[i+1] ? todayLessons[i+1].name : "No more lessons today";
            break;
        }
        if (currentTime < todayLessons[i].start) {
            currentLesson = "No current lesson";
            nextLesson = todayLessons[i].name;
            break;
        }
    }
    if (!currentLesson) {
        currentLesson = "No more lessons today";
        nextLesson = "";
    }
    return { currentLesson, nextLesson };
}
function updateCountdown() {
    const now = new Date();
    const countdownEl = document.getElementById("countdown");
    const lessonEl = document.getElementById("lessonInfo");
    const moodImage = document.getElementById("moodImage");
    const progressEl = document.getElementById("progress");

    if (now < startDateTime) {
        countdownEl.textContent = `Countdown starts on ${startDateTime.toLocaleString()}`;
        lessonEl.textContent = "";
        moodImage.src = "images/Sad.png";
        document.body.style.setProperty('--bg-image', "url('images/Stare.png')");
        return;
    }

    const ongoingBreak = currentBreak(now);
    if (ongoingBreak || isWeekend(now)) {
        let remaining = ongoingBreak ? ongoingBreak.to - now : 0;
        countdownEl.textContent = ongoingBreak
            ? `Break! Time left: ${formatDHMS(remaining)}`
            : `Weekend! Enjoy your time.\nCurrent: ${now.toLocaleString()}`;
        lessonEl.textContent = "";
        moodImage.src = "images/Happy.png";
        document.body.style.setProperty('--bg-image', "url('images/Yay.png')");
        if (ongoingBreak) triggerConfetti();
        return;
    }

    const schoolDaysLeft = countSchoolDays(now, endDate);
    const totalMs = endDate - now;
    countdownEl.textContent = `${schoolDaysLeft} school days left | ${formatDHMS(totalMs)}`;

    const lessonInfo = getLessonInfo(now);
    lessonEl.textContent = `Current: ${lessonInfo.currentLesson}\nNext: ${lessonInfo.nextLesson}`;

    moodImage.src = "images/Sad.png";
    document.body.style.setProperty('--bg-image', "url('images/Stare.png')");

    const totalDays = countSchoolDays(startDateTime, endDate);
    const percent = ((totalDays - schoolDaysLeft) / totalDays) * 100;
    progressEl.style.width = percent + '%';
}
setInterval(updateCountdown, 1000);
updateCountdown();
</script>
</body>
</html>
