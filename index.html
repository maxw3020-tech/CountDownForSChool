<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Enhanced School Countdown</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(to top, #001, #000);
      transition: background 2s;
    }

    .card {
      position: relative;
      background: rgba(0,0,0,0.5);
      padding: 30px 40px;
      border-radius: 20px;
      text-align: center;
      border: 2px solid orange;
      color: orange;
      z-index: 2;
      width: 90%;
      max-width: 500px;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 15px;
      text-shadow: 0 0 5px #ff8c00, 0 0 10px #ff8c00;
    }

    #countdown {
      font-size: 2rem;
      margin: 15px 0;
      padding: 15px;
      border-radius: 15px;
      border: 2px solid orange;
      background: rgba(0,0,0,0.3);
      color: orange;
      text-shadow: 0 0 5px #ff8c00, 0 0 10px #ff8c00;
      white-space: pre-line;
      transition: font-size 0.5s;
    }

    #progressBar {
      width: 100%;
      background: rgba(255,255,255,0.2);
      border-radius: 15px;
      overflow: hidden;
      margin-top: 10px;
    }

    #progress {
      width: 0%;
      height: 15px;
      background: orange;
      border-radius: 15px;
      transition: width 0.5s;
    }

    #moodImage {
      margin-top: 15px;
      width: 200px;
      border-radius: 15px;
      border: 2px solid orange;
      opacity: 1;
      transition: opacity 1s;
    }

    .emoji {
      font-size: 2rem;
      margin-top: 10px;
    }

    .star {
      position: absolute;
      border-radius: 50%;
      background: white;
      opacity: 0.8;
    }

    canvas.confetti {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>School Countdown</h1>
    <div id="countdown">Loading...</div>
    <div id="progressBar">
      <div id="progress"></div>
    </div>
    <img id="moodImage" src="images/Sad.jpg" alt="Mood Image">
    <div class="emoji" id="emoji">ðŸ˜´</div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    // ==== Starry Sky ====
    const numStars = 150;
    const stars = [];

    for (let i = 0; i < numStars; i++) {
      const star = document.createElement('div');
      star.classList.add('star');
      star.style.top = Math.random() * window.innerHeight + 'px';
      star.style.left = Math.random() * window.innerWidth + 'px';
      const size = Math.random() * 2 + 1;
      star.style.width = size + 'px';
      star.style.height = size + 'px';
      star.dataset.speed = Math.random() * 0.2 + 0.05;
      star.dataset.opacity = Math.random() * 0.5 + 0.5;
      document.body.appendChild(star);
      stars.push(star);
    }

    function animateStars() {
      stars.forEach(star => {
        const twinkle = Math.sin(Date.now() * 0.002 + Math.random() * 100) * 0.5 + 0.5;
        star.style.opacity = star.dataset.opacity * twinkle;

        let left = parseFloat(star.style.left);
        left += parseFloat(star.dataset.speed);
        if (left > window.innerWidth) left = 0;
        star.style.left = left + 'px';
      });
      requestAnimationFrame(animateStars);
    }
    animateStars();

    // ==== School Countdown Data ====
    const startDateTime = new Date(2025, 7, 19, 8, 30);
    const endDate = new Date(2026, 5, 12, 0, 0);

    const breaks = [
      { from: new Date(2025, 9, 27), to: new Date(2025, 9, 31) },
      { from: new Date(2026, 1, 16), to: new Date(2026, 1, 20) },
      { from: new Date(2026, 2, 30), to: new Date(2026, 3, 2) },
      { from: new Date(2026, 4, 15), to: new Date(2026, 4, 15) },
      { from: new Date(2025, 10, 17), to: new Date(2025, 10, 17) },
      { from: new Date(2026, 0, 7), to: new Date(2026, 0, 7) },
      { from: new Date(2026, 2, 3), to: new Date(2026, 2, 3) },
      { from: new Date(2025, 11, 3), to: new Date(2025, 11, 3) },
      { from: new Date(2026, 4, 25), to: new Date(2026, 4, 25) }
    ];

    function isWeekend(date) {
      const day = date.getDay();
      return day === 0 || day === 6;
    }

    function currentBreak(date) {
      return breaks.find(b => date >= b.from && date <= b.to);
    }

    function formatDHMS(ms) {
      const totalSeconds = Math.floor(ms / 1000);
      const days = Math.floor(totalSeconds / (3600 * 24));
      const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
      const minutes = Math.floor((totalSeconds % 3600) / 60);
      const seconds = totalSeconds % 60;
      return `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    function countSchoolDays(fromDate, toDate) {
      let count = 0;
      let current = new Date(fromDate);
      while (current <= toDate) {
        if (!isWeekend(current) && !currentBreak(current)) count++;
        current.setDate(current.getDate() + 1);
      }
      return count;
    }

    function updateSky() {
      const now = new Date();
      const hour = now.getHours();
      let gradient = '';
      if (hour >= 6 && hour < 9) gradient = 'linear-gradient(to top, #FFA500, #001)'; // sunrise
      else if (hour >= 9 && hour < 18) gradient = 'linear-gradient(to top, #87CEEB, #001)'; // day
      else if (hour >= 18 && hour < 20) gradient = 'linear-gradient(to top, #FF4500, #001)'; // sunset
      else gradient = 'linear-gradient(to top, #001, #000)'; // night
      document.body.style.background = gradient;
    }

    function triggerConfetti() {
      confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      });
    }

    function updateCountdown() {
      const now = new Date();
      const countdownEl = document.getElementById("countdown");
      const moodImage = document.getElementById("moodImage");
      const emojiEl = document.getElementById("emoji");
      const progressEl = document.getElementById("progress");

      updateSky();

      if (now < startDateTime) {
        countdownEl.textContent = `Countdown starts on ${startDateTime.toLocaleString()}`;
        moodImage.src = "images/Sad.jpg";
        emojiEl.textContent = 'ðŸ˜´';
        return;
      }

      if (isWeekend(now)) {
        countdownEl.textContent = `It's the weekend, don't worry!\nCurrent: ${now.toLocaleString()}`;
        moodImage.src = "images/Happy.jpg";
        emojiEl.textContent = 'ðŸŽ‰';
        return;
      }

      const ongoingBreak = currentBreak(now);
      if (ongoingBreak) {
        const remaining = ongoingBreak.to - now;
        countdownEl.textContent = `It's LOV! Time left: ${formatDHMS(remaining)}`;
        moodImage.src = "images/Happy.jpg";
        emojiEl.textContent = 'ðŸŽ‰';
        triggerConfetti();
        return;
      }

      // Normal school day
      const schoolDaysLeft = countSchoolDays(now, endDate);
      const totalMs = endDate - now;
      const fontSize = Math.min(60, Math.max(24, 2 + (totalMs/1000000000)));
      countdownEl.style.fontSize = `${fontSize}px`;
      countdownEl.textContent = `${schoolDaysLeft} school days left | ${formatDHMS(totalMs)}`;
      moodImage.src = "images/Sad.jpg";
      emojiEl.textContent = 'ðŸ˜´';

      // Update progress bar
      const totalDays = countSchoolDays(startDateTime, endDate);
      const percent = ((totalDays - schoolDaysLeft) / totalDays) * 100;
      progressEl.style.width = percent + '%';
    }

    setInterval(updateCountdown, 1000);
    updateCountdown();
  </script>
</body>
</html>
